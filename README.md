# MSF-screenrecord-on-MacOS
~~!!! This vulnerability has been simultaneously discovered or taken by Sudhakar Muthumani of Primefort Private Limited, Khiem Tran and listed as CVE-2022-22600. This is despite I already emailing Apple regarding this back in 2021.~~

It is possible the exploits discovered are different as mine still works on macOS Monterey 12.3. For those that test it, can you please inform me if that is consistently true?
## Affected Versions
As a student, I have limited access to devices in which I can test this vulnerability. The versions I have tested so far are `MacOS 12.1`, `MacOS 12.0`, and `MacOS 11.6.1`.

## POC
Files are in the POC directory. Just run `POC.sh` and a screenshot will be produced without TCC prompt.

## So what is the bug?
MacOS stores permissions based on executables. Thus, if the executable cannot be found after the code has already been loaded into memory, no permissions are restricted.
## Patched versions -- According to Apple
The issue was addressed with improved permissions logic. This issue is fixed in tvOS 15.4, iOS 15.4 and iPadOS 15.4, macOS Monterey 12.3, watchOS 8.5. A malicious application may be able to bypass certain Privacy preferences.

!!! For unknown reasons, it still works on macOS Monterey when I tested it. And no, I did properly clear TCC permissions.

## History and additional functions
This exploit was first discovered by me when experimenting with Metasploit's web delivery. I found that by deleting the dropped executable immediately after a meterpreter shell opens, the shell gains capabilities which are normally locked behind a TCC prompt. This vulnerability also allows an attacker to inject keystrokes. However, I am not an Objective-C developer and thus have not been able to create my own POC. This effect can still be achieved through Metasploit.
